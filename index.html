<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BMW Sales Analysis Dashboard</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Apple-like font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0a0a0f, #1c1c2b, #0d0d0d);
      color: #e5e5e5;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 1rem 0;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,0.6);
    }
    header h1 {
      font-size: 1.6rem;
      font-weight: 600;
      margin: 0;
      color: #dcdcff;
    }
    .filter {
      text-align: center;
      margin: 1.5rem 0;
    }
    select {
      padding: 0.6rem 1.2rem;
      border-radius: 12px;
      border: none;
      font-size: 1rem;
      background: #2d2d3a;
      color: #fff;
      cursor: pointer;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 2rem;
      padding: 2rem;
      max-width: 1400px;
      margin: auto;
    }
    .chart-card {
      background: rgba(255,255,255,0.07);
      border-radius: 16px;
      padding: 1.5rem;
      backdrop-filter: blur(12px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    }
    .chart-title {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: #bdbdff;
    }
    canvas {
      width: 100% !important;
      height: 340px !important;
    }
    footer {
      text-align: center;
      padding: 1rem;
      margin-top: 2rem;
      font-size: 0.9rem;
      color: #aaa;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    @media (max-width: 768px) {
      header h1 {
        font-size: 1.3rem;
      }
      canvas {
        height: 260px !important;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>BMW Sales Analysis Dashboard</h1>
  </header>

  <!-- Year Filter -->
  <div class="filter">
    <label for="yearFilter">Filter by Year:</label>
    <select id="yearFilter">
      <option value="All">All</option>
    </select>
  </div>

  <!-- Dashboard Charts -->
  <div class="container">
    <div class="chart-card">
      <div class="chart-title">üìà Sales Trend by Year (Line Chart)</div>
      <canvas id="salesTrend"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-title">üìä Sales Trend by Year (Area Chart)</div>
      <canvas id="salesArea"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-title">üé® Popular Car Colors (Donut)</div>
      <canvas id="colorDonut"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-title">üåç Sales by Region (Bar)</div>
      <canvas id="regionBar"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-title">‚öôÔ∏è Engine Size vs Sales (Bar)</div>
      <canvas id="engineBar"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-title">üöò Transmission Types (Pie)</div>
      <canvas id="transmissionPie"></canvas>
    </div>
  </div>

  <footer>
    ¬© 2025 BMW Sales Analysis | Designed with elegance & precision
  </footer>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSbkKYeVn1qV4pJKqtTnbD7CLYiJ-ZP3dQjFdpT0nbrxtgW4jl2BuejOYY5GKBzkmFzrxGxrIwOA7tP/pub?output=csv";

    async function loadData() {
      try {
        const response = await fetch(sheetURL);
        const csvData = await response.text();
        const rows = csvData.split("\n").map(r => r.split(","));
        const headers = rows[0];
        const data = rows.slice(1);

        const yearIndex = headers.indexOf("Year");
        const colorIndex = headers.indexOf("Color");
        const regionIndex = headers.indexOf("Region");
        const engineIndex = headers.indexOf("Engine_Size_L");
        const transmissionIndex = headers.indexOf("Transmission");
        const salesIndex = headers.indexOf("Sales_Volume");

        const yearFilter = document.getElementById("yearFilter");
        const years = [...new Set(data.map(r => r[yearIndex]))];
        years.forEach(y => {
          let opt = document.createElement("option");
          opt.value = y; opt.textContent = y;
          yearFilter.appendChild(opt);
        });

        function filterData(year) {
          return year === "All" ? data : data.filter(r => r[yearIndex] === year);
        }

        function renderCharts(year="All") {
          const filtered = filterData(year);

          const yearSales = {};
          filtered.forEach(r => {
            const yr = r[yearIndex];
            const sales = parseInt(r[salesIndex]) || 0;
            yearSales[yr] = (yearSales[yr] || 0) + sales;
          });

          const colorSales = {};
          filtered.forEach(r => {
            const c = r[colorIndex];
            const sales = parseInt(r[salesIndex]) || 0;
            colorSales[c] = (colorSales[c] || 0) + sales;
          });

          const regionSales = {};
          filtered.forEach(r => {
            const reg = r[regionIndex];
            const sales = parseInt(r[salesIndex]) || 0;
            regionSales[reg] = (regionSales[reg] || 0) + sales;
          });

          const engineSales = {};
          filtered.forEach(r => {
            const eng = r[engineIndex];
            const sales = parseInt(r[salesIndex]) || 0;
            engineSales[eng] = (engineSales[eng] || 0) + sales;
          });

          const transmissionSales = {};
          filtered.forEach(r => {
            const tr = r[transmissionIndex];
            const sales = parseInt(r[salesIndex]) || 0;
            transmissionSales[tr] = (transmissionSales[tr] || 0) + sales;
          });

          // Destroy old charts
          Chart.helpers.each(Chart.instances, function(instance) { instance.destroy(); });

          // Sales Trend (Line)
          new Chart(document.getElementById("salesTrend"), {
            type: "line",
            data: {
              labels: Object.keys(yearSales),
              datasets: [{
                label: "Sales Volume",
                data: Object.values(yearSales),
                borderColor: "#4facfe",
                backgroundColor: "transparent"
              }]
            }
          });

          // Sales Trend (Area)
          new Chart(document.getElementById("salesArea"), {
            type: "line",
            data: {
              labels: Object.keys(yearSales),
              datasets: [{
                label: "Sales Volume",
                data: Object.values(yearSales),
                borderColor: "#43e97b",
                backgroundColor: "rgba(67,233,123,0.3)",
                fill: true
              }]
            }
          });

          // Colors Donut
          const colorMap = {
            "Red": "#ff0000", "Blue": "#0000ff", "Black": "#000000",
            "White": "#ffffff", "Silver": "#c0c0c0", "Grey": "#808080"
          };
          new Chart(document.getElementById("colorDonut"), {
            type: "doughnut",
            data: {
              labels: Object.keys(colorSales),
              datasets: [{
                data: Object.values(colorSales),
                backgroundColor: Object.keys(colorSales).map(c => colorMap[c] || "#888")
              }]
            }
          });

          // Region Bar
          new Chart(document.getElementById("regionBar"), {
            type: "bar",
            data: {
              labels: Object.keys(regionSales),
              datasets: [{
                label: "Sales Volume",
                data: Object.values(regionSales),
                backgroundColor: "#7f5af0"
              }]
            }
          });

          // Engine Bar
          new Chart(document.getElementById("engineBar"), {
            type: "bar",
            data: {
              labels: Object.keys(engineSales),
              datasets: [{
                label: "Sales Volume",
                data: Object.values(engineSales),
                backgroundColor: "#2cb67d"
              }]
            }
          });

          // Transmission Pie
          new Chart(document.getElementById("transmissionPie"), {
            type: "pie",
            data: {
              labels: Object.keys(transmissionSales),
              datasets: [{
                data: Object.values(transmissionSales),
                backgroundColor: ["#ff9f1c", "#2ec4b6", "#e71d36", "#9b5de5"]
              }]
            }
          });
        }

        renderCharts();

        yearFilter.addEventListener("change", e => renderCharts(e.target.value));

      } catch (err) {
        alert("Error loading sheet: " + err.message);
      }
    }
    loadData();
  </script>
</body>
</html>
