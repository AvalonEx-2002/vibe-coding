<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BMW Sales Analysis Dashboard</title>

  <!-- Geist font -->
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Geist', sans-serif;
      background: #0d0d1a;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header, footer {
      width: 100%;
      padding: 1.2rem;
      text-align: center;
      font-weight: 600;
      font-size: 1.8rem;
      color: #fff;
      background: linear-gradient(135deg, #1a1a2e, #0f3460, #533483);
    }

    footer {
      font-size: 1rem;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      padding: 2rem;
      width: 95%;
      max-width: 1400px;
    }

    .card {
      background: rgba(25, 25, 40, 0.9);
      border-radius: 20px;
      padding: 1rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    }

    .card h2 {
      font-size: 1.2rem;
      margin-bottom: 0.8rem;
      text-align: center;
      color: #e0e0ff;
    }

    canvas {
      width: 100% !important;
      height: 300px !important;
    }

    .filters {
      margin: 1rem 0;
      text-align: center;
    }

    select {
      padding: 0.5rem;
      border-radius: 8px;
      border: none;
      background: #1f1f2e;
      color: #fff;
      font-weight: 500;
      outline: none;
    }

    @media (max-width: 768px) {
      header { font-size: 1.5rem; }
      .card h2 { font-size: 1rem; }
      canvas { height: 250px !important; }
    }
  </style>
</head>
<body>

  <header>
    BMW Sales Analysis Dashboard
  </header>

  <div class="filters">
    <label for="yearFilter">Filter by Year:</label>
    <select id="yearFilter"></select>
  </div>

  <div class="dashboard">
    <div class="card">
      <h2>Sales Trend (Yearly)</h2>
      <canvas id="salesTrend"></canvas>
    </div>

    <div class="card">
      <h2>Sales by Region</h2>
      <canvas id="regionDonut"></canvas>
    </div>

    <div class="card">
      <h2>Sales by Color</h2>
      <canvas id="colorDonut"></canvas>
    </div>

    <div class="card">
      <h2>Sales by Engine Size</h2>
      <canvas id="engineBar"></canvas>
    </div>

    <div class="card">
      <h2>Sales by Fuel Type</h2>
      <canvas id="fuelPie"></canvas>
    </div>

    <div class="card">
      <h2>Sales by Transmission</h2>
      <canvas id="transmissionPie"></canvas>
    </div>

    <div class="card">
      <h2>Sales by Car Model</h2>
      <canvas id="modelBar"></canvas>
    </div>
  </div>

  <footer>
    Â© 2025 BMW Sales Dashboard | Powered by Chart.js
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSbkKYeVn1qV4pJKqtTnbD7CLYiJ-ZP3dQjFdpT0nbrxtgW4jl2BuejOYY5GKBzkmFzrxGxrIwOA7tP/pub?output=csv";

    let dataset = [];
    let charts = {};
    const yearFilter = document.getElementById("yearFilter");

    async function loadData() {
      const res = await fetch(SHEET_URL);
      const text = await res.text();
      const rows = text.split("\n").map(r => r.split(","));

      const headers = rows[0].map(h => h.trim());
      dataset = rows.slice(1).map(r => {
        let obj = {};
        headers.forEach((h, i) => obj[h] = r[i]?.trim());
        obj["Year"] = parseInt(obj["Year"]);
        obj["Sales_Volume"] = parseInt(obj["Sales_Volume"]) || 0;
        return obj;
      });

      initUI();
    }

    function initUI() {
      // Populate years filter
      const years = [...new Set(dataset.map(d => d.Year))].sort((a, b) => a - b);
      yearFilter.innerHTML = "";
      years.forEach(y => {
        const option = document.createElement("option");
        option.value = y;
        option.textContent = y;
        yearFilter.appendChild(option);
      });

      initCharts();
      updateCharts(years[0]);

      yearFilter.addEventListener("change", e => updateCharts(parseInt(e.target.value)));
    }

    function aggregate(data, key) {
      const groups = {};
      data.forEach(d => {
        const val = d[key];
        groups[val] = (groups[val] || 0) + d.Sales_Volume;
      });
      return groups;
    }

    function updateCharts(selectedYear) {
      const filtered = dataset.filter(d => d.Year === selectedYear);

      // Sales Trend (all years, not filtered)
      const yearly = aggregate(dataset, "Year");
      charts.salesTrend.data.labels = Object.keys(yearly);
      charts.salesTrend.data.datasets[0].data = Object.values(yearly);
      charts.salesTrend.update();

      // Region
      const regionAgg = aggregate(filtered, "Region");
      charts.regionDonut.data.labels = Object.keys(regionAgg);
      charts.regionDonut.data.datasets[0].data = Object.values(regionAgg);
      charts.regionDonut.update();

      // Color
      const colorAgg = aggregate(filtered, "Color");
      charts.colorDonut.data.labels = Object.keys(colorAgg);
      charts.colorDonut.data.datasets[0].data = Object.values(colorAgg);
      charts.colorDonut.data.datasets[0].backgroundColor = Object.keys(colorAgg).map(c => c.toLowerCase());
      charts.colorDonut.update();

      // Engine Size
      const engineAgg = aggregate(filtered, "Engine_Size_L");
      charts.engineBar.data.labels = Object.keys(engineAgg);
      charts.engineBar.data.datasets[0].data = Object.values(engineAgg);
      charts.engineBar.update();

      // Fuel Type
      const fuelAgg = aggregate(filtered, "Fuel_Type");
      charts.fuelPie.data.labels = Object.keys(fuelAgg);
      charts.fuelPie.data.datasets[0].data = Object.values(fuelAgg);
      charts.fuelPie.update();

      // Transmission
      const transAgg = aggregate(filtered, "Transmission");
      charts.transmissionPie.data.labels = Object.keys(transAgg);
      charts.transmissionPie.data.datasets[0].data = Object.values(transAgg);
      charts.transmissionPie.update();

      // Model
      const modelAgg = aggregate(filtered, "Model");
      charts.modelBar.data.labels = Object.keys(modelAgg);
      charts.modelBar.data.datasets[0].data = Object.values(modelAgg);
      charts.modelBar.update();
    }

    function initCharts() {
      const chartFont = {
        family: 'Geist',
        size: 13,
        weight: '500'
      };

      charts.salesTrend = new Chart(document.getElementById("salesTrend"), {
        type: "line",
        data: { labels: [], datasets: [{ label: "Sales", data: [], borderColor: "#00aaff", backgroundColor: "rgba(0,170,255,0.3)", fill: true, tension: 0.3 }] },
        options: { plugins: { legend: { labels: { font: chartFont, color: "#fff" } } }, scales: { x: { ticks: { color: "#fff", font: chartFont } }, y: { ticks: { color: "#fff", font: chartFont } } } }
      });

      charts.regionDonut = new Chart(document.getElementById("regionDonut"), {
        type: "doughnut",
        data: { labels: [], datasets: [{ data: [] }] },
        options: { plugins: { legend: { labels: { font: chartFont, color: "#fff" } } } }
      });

      charts.colorDonut = new Chart(document.getElementById("colorDonut"), {
        type: "doughnut",
        data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
        options: { plugins: { legend: { labels: { font: chartFont, color: "#fff" } } } }
      });

      charts.engineBar = new Chart(document.getElementById("engineBar"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Sales", data: [], backgroundColor: "#9d4edd" }] },
        options: { scales: { x: { ticks: { color: "#fff", font: chartFont } }, y: { ticks: { color: "#fff", font: chartFont } } } }
      });

      charts.fuelPie = new Chart(document.getElementById("fuelPie"), {
        type: "pie",
        data: { labels: [], datasets: [{ data: [] }] },
        options: { plugins: { legend: { labels: { font: chartFont, color: "#fff" } } } }
      });

      charts.transmissionPie = new Chart(document.getElementById("transmissionPie"), {
        type: "pie",
        data: { labels: [], datasets: [{ data: [] }] },
        options: { plugins: { legend: { labels: { font: chartFont, color: "#fff" } } } }
      });

      charts.modelBar = new Chart(document.getElementById("modelBar"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Sales", data: [], backgroundColor: "#5f27cd" }] },
        options: { scales: { x: { ticks: { color: "#fff", font: chartFont, maxRotation: 90, minRotation: 90 } }, y: { ticks: { color: "#fff", font: chartFont } } } }
      });
    }

    loadData();
  </script>
</body>
</html>
