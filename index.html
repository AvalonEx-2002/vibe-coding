<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BMW Sales Analysis Dashboard</title>
  
  <!-- Geist Font -->
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Geist', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #0a0a0f, #0d1b2a);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header, footer {
      width: 100%;
      text-align: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    footer {
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      margin-top: 20px;
    }

    h1 {
      font-size: 1.8rem;
      margin: 0;
      font-weight: 600;
    }

    .filter-container {
      margin: 20px;
      text-align: center;
    }

    select {
      padding: 8px;
      border-radius: 6px;
      background: #1c2541;
      color: white;
      border: 1px solid #3a506b;
      font-size: 14px;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      padding: 20px;
      width: 90%;
      max-width: 1400px;
    }

    .card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      text-align: center;
    }

    canvas {
      max-width: 100%;
      height: auto !important;
    }
  </style>
</head>
<body>
  <header>
    <h1>BMW Sales Analysis Dashboard</h1>
  </header>

  <div class="filter-container">
    <label for="yearFilter">Filter by Year: </label>
    <select id="yearFilter"></select>
  </div>

  <div class="dashboard">
    <div class="card">
      <h3>Sales Trend (Line Chart)</h3>
      <canvas id="lineChart"></canvas>
    </div>
    <div class="card">
      <h3>Sales by Region</h3>
      <canvas id="regionChart"></canvas>
    </div>
    <div class="card">
      <h3>Sales by Color</h3>
      <canvas id="colorChart"></canvas>
    </div>
    <div class="card">
      <h3>Sales by Engine Size</h3>
      <canvas id="engineChart"></canvas>
    </div>
    <div class="card">
      <h3>Sales by Fuel Type</h3>
      <canvas id="fuelChart"></canvas>
    </div>
    <div class="card">
      <h3>Sales by Transmission</h3>
      <canvas id="transmissionChart"></canvas>
    </div>
    <div class="card">
      <h3>Sales by Car Model</h3>
      <canvas id="modelChart"></canvas>
    </div>
  </div>

  <footer>
    <p>Â© 2025 BMW Sales Dashboard | Powered by Chart.js</p>
  </footer>

  <script>
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSbkKYeVn1qV4pJKqtTnbD7CLYiJ-ZP3dQjFdpT0nbrxtgW4jl2BuejOYY5GKBzkmFzrxGxrIwOA7tP/pub?output=csv";
    let allData = [];
    let charts = {};

    async function fetchData() {
      const response = await fetch(url);
      const text = await response.text();
      const rows = text.split("\n").map(r => r.split(","));
      const headers = rows[0];
      const data = rows.slice(1).map(r => Object.fromEntries(headers.map((h, i) => [h.trim(), r[i]])));
      allData = data;
      populateYearFilter();
      updateCharts();
    }

    function populateYearFilter() {
      const yearFilter = document.getElementById("yearFilter");
      const years = [...new Set(allData.map(d => d.Year))].sort((a,b) => a - b);
      years.forEach(year => {
        const option = document.createElement("option");
        option.value = year;
        option.textContent = year;
        yearFilter.appendChild(option);
      });
      yearFilter.addEventListener("change", updateCharts);
    }

    function updateCharts() {
      const year = document.getElementById("yearFilter").value;
      const filteredData = year ? allData.filter(d => d.Year === year) : allData;

      createLineChart(filteredData);
      createBarChart(filteredData, "Region", "regionChart", "Sales by Region");
      createDonutChart(filteredData, "Color", "colorChart", "Sales by Color", true);
      createBarChart(filteredData, "Engine Size", "engineChart", "Sales by Engine Size");
      createPieChart(filteredData, "Fuel Type", "fuelChart", "Sales by Fuel Type");
      createPieChart(filteredData, "Transmission", "transmissionChart", "Sales by Transmission");
      createBarChart(filteredData, "Model", "modelChart", "Sales by Car Model", true);
    }

    function prepareData(data, key) {
      const counts = {};
      data.forEach(d => {
        counts[d[key]] = (counts[d[key]] || 0) + 1;
      });
      return Object.entries(counts).map(([label, value]) => ({label, value}));
    }

    function createLineChart(data) {
      const counts = prepareData(data, "Year").sort((a,b) => a.label - b.label);
      const ctx = document.getElementById("lineChart").getContext("2d");
      if (charts.line) charts.line.destroy();
      charts.line = new Chart(ctx, {
        type: "line",
        data: {
          labels: counts.map(c => c.label),
          datasets: [{
            label: "Sales Trend",
            data: counts.map(c => c.value),
            borderColor: "#3a86ff",
            backgroundColor: "#3a86ff33",
            fill: true
          }]
        }
      });
    }

    function createBarChart(data, key, chartId, label, rotate=false) {
      const counts = prepareData(data, key).sort((a,b) => a.value - b.value);
      const ctx = document.getElementById(chartId).getContext("2d");
      if (charts[chartId]) charts[chartId].destroy();
      charts[chartId] = new Chart(ctx, {
        type: "bar",
        data: {
          labels: counts.map(c => c.label),
          datasets: [{
            label,
            data: counts.map(c => c.value),
            backgroundColor: "#4361ee"
          }]
        },
        options: {
          indexAxis: rotate ? "x" : "y",
          scales: {
            x: { ticks: { color: "white" }},
            y: { ticks: { color: "white" }}
          }
        }
      });
    }

    function createDonutChart(data, key, chartId, label, useColors=false) {
      const counts = prepareData(data, key).sort((a,b) => a.value - b.value);
      const ctx = document.getElementById(chartId).getContext("2d");
      if (charts[chartId]) charts[chartId].destroy();
      charts[chartId] = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: counts.map(c => c.label),
          datasets: [{
            label,
            data: counts.map(c => c.value),
            backgroundColor: useColors ? counts.map(c => c.label.toLowerCase()) : ["#f72585","#7209b7","#3a0ca3","#4361ee","#4cc9f0"]
          }]
        }
      });
    }

    function createPieChart(data, key, chartId, label) {
      const counts = prepareData(data, key).sort((a,b) => a.value - b.value);
      const ctx = document.getElementById(chartId).getContext("2d");
      if (charts[chartId]) charts[chartId].destroy();
      charts[chartId] = new Chart(ctx, {
        type: "pie",
        data: {
          labels: counts.map(c => c.label),
          datasets: [{
            label,
            data: counts.map(c => c.value),
            backgroundColor: ["#f94144","#f3722c","#f9c74f","#90be6d","#43aa8b","#577590"]
          }]
        }
      });
    }

    fetchData();
  </script>
</body>
</html>
